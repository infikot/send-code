<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>send-code.ru</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='bootstrap.min.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
    <link rel="icon" type="image/x-icon" href="{{ url_for('static', filename='favicon.png') }}">
    <!-- –ò–Ω–¥–µ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.28.0/themes/prism-tomorrow.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.6.0/styles/default.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.28.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.6.0/highlight.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.6.0/languages/autoit.min.js"></script>
</head>
<body>
    <!-- –≠—Ç–∏ ***—á–∏–µ —Ñ–∏–∫—Å—ã —è –∏ –≤–ø—Ä–∞–≤–¥—É –¥–µ–ª–∞–ª —Å –ø–æ–º–æ—â—å—é –Ω–µ–π—Ä–æ—Å–µ—Ç–∏ —Ç–∫ –Ω–µ –ø–æ–Ω–∏–º–∞–ª –≤ —á—ë–º –±–∞–≥, –Ω–µ –≤–∞–º –º–µ–Ω—è –æ—Å—É–∂–¥–∞—Ç—å! -->
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
        <a class="navbar-brand" href="{{ url_for('index') }}">
            <span class="d-block d-sm-inline">Send-Code -</span>
            <span class="d-block d-sm-inline">–ö–æ–ø–∏—Ä—É–π, –æ—Ç–ø—Ä–∞–≤–ª—è–π, –¥–µ–ª–∏—Å—å!</span>
        </a>
        <div class="w-100">
            <ul class="navbar-nav d-flex">
                <li class="nav-item">
                    <a class="nav-link" href="{{ url_for('index') }}">–ì–ª–∞–≤–Ω–∞—è</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="{{ url_for('new_paste') }}">–ù–æ–≤–∞—è –≤—Å—Ç–∞–≤–∫–∞</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="{{ url_for('about') }}">–û –ø—Ä–æ–µ–∫—Ç–µ</a>
                </li>
            </ul>
        </div>
    </nav>
    <div class="container">
        {% block content %}{% endblock %}
    </div>
    <!-- –ò–Ω–¥–µ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ -->
    <script>
        document.addEventListener("DOMContentLoaded", function() {
            var contentTextarea = document.getElementById("content");
            var previewCode = document.getElementById("preview");

            contentTextarea.addEventListener("input", function() {
                previewCode.textContent = contentTextarea.value;
                Prism.highlightElement(previewCode);
            });
        });
    </script>
    <!-- –ß–∞—Ç-–±–æ—Ç -->
    <div class="chat-button" onclick="toggleChat()">üí¨</div>
    <div class="chat-window" id="chatWindow">
        <div class="chat-header">
            <span>–ß–∞—Ç —Å Send-Code AI</span>
            <span class="chat-close" onclick="toggleChat()">‚úñ</span>
        </div>
        <div class="chat-messages" id="chatMessages"></div>
        <div class="chat-input">
            <input type="text" id="chatInput" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ...">
            <button onclick="sendMessage()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
        </div>
    </div>

    <script>
        let chatHistory = [];
        let lastRequestTime = 0;

        function toggleChat() {
            const chatWindow = document.getElementById('chatWindow');
            chatWindow.style.display = chatWindow.style.display === 'none' ? 'block' : 'none';
        }

        function sendMessage() {
            const now = Date.now();
            if (now - lastRequestTime < 50000) {
                alert("–ó–∞–ø—Ä–æ—Å—ã –º–æ–∂–Ω–æ –¥–µ–ª–∞—Ç—å —Ä–∞–∑ –≤ 50 —Å–µ–∫—É–Ω–¥");
                return;
            }

            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            if (message) {
                displayMessage('User: ' + message);
                chatHistory.push('User: ' + message);

                // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å –∫ –Ω–∞—à–µ–º—É API
                fetch(`/generate_neuro?history=${encodeURIComponent(chatHistory.join('\n'))}`)
                    .then(response => response.json())
                    .then(data => {
                        if (data.error) {
                            displayMessage('Error: ' + data.error);
                        } else {
                            displayMessage('AI: ' + data.response);
                            chatHistory.push('AI: ' + data.response);
                        }
                    })
                    .catch(error => {
                        displayMessage('Error: ' + error);
                    });

                input.value = '';
                lastRequestTime = now;
            }
        }

        function displayMessage(message) {
            const chatMessages = document.getElementById('chatMessages');
            const messageElement = document.createElement('div');
            messageElement.textContent = message;
            chatMessages.appendChild(messageElement);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞–∂–∞—Ç–∏—è Enter –≤ –ø–æ–ª–µ –≤–≤–æ–¥–∞
        document.getElementById('chatInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });
    </script>
</body>
</html>
